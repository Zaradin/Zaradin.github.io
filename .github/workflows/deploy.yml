name: Build and deploy Jekyll site to GitHub Pages

on:
    push:
        branches:
            - master # Trigger on pushes to the main branch
    schedule:
        - cron: "0 0 * * *" # Scheduled to run daily at midnight UTC

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v2

            - name: Set up Ruby
              uses: ruby/setup-ruby@v1
              with:
                  ruby-version: "3.0" # Adjust Ruby version as necessary

            - name: Install dependencies
              run: |
                  bundle config set --local path 'vendor/bundle'
                  bundle install --jobs 4 --retry 3 --without development test

            - name: Build Jekyll site
              run: bundle exec jekyll build

            - name: Deploy to GitHub Pages
              uses: peaceiris/actions-gh-pages@v4
              with:
                  github_token: ${{ secrets.GH_PAT }} # GitHub token for authentication
                  publish_dir: ./_site # Directory to deploy
                  cname: "" # Custom domain (optional)

            - name: Cleanup
              run: |
                  bundle exec jekyll clean

            - name: Debug Log Files
              run: |
                  ls -R ./_site  # List all files in _site directory for debugging

            - name: Display Gemfile.lock
              run: |
                  cat Gemfile.lock  # Display Gemfile.lock for version checks

            - name: Display Bundler Environment
              run: |
                  bundle env  # Display Bundler environment for further debugging
