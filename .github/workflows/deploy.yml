name: Build and Deploy to GitHub Pages

on:
    push:
        branches:
            - main # Here source code branch is `main`, it could be other branch
    schedule:
        - cron: "0 0 * * *" # This schedules the workflow to run daily at midnight UTC

permissions:
    contents: read
    pages: write
    id-token: write

jobs:
    build_and_deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Cache dependencies
              uses: actions/cache@v4
              with:
                  path: |
                      .asdf
                      vendor/bundle
                  key: ${{ runner.os }}-cache-${{ hashFiles('**/Gemfile.lock') }}
                  restore-keys: |
                      ${{ runner.os }}-cache-

            - name: Build and Deploy to GitHub Pages
              uses: jeffreytse/jekyll-deploy-action@v0.6.0
              with:
                  provider: "github"
                  token: ${{ secrets.GITHUB_TOKEN }}
                  branch: "gh-pages" # Default is gh-pages for github provider
                  jekyll_src: "./" # Default is root directory
                  jekyll_cfg: "_config.yml" # Default is _config.yml
                  pre_build_commands: "" # Optional, additional commands before build
